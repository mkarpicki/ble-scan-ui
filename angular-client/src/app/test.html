<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Your Canvas</title>

<style type="text/css"><!--
#container { position: relative; }
#imageTemp { position: absolute; top: 1px; left: 1px; }
--></style>

</head>
<body>
<canvas id="imageView" width="600" height="500"></canvas>

<script type="text/javascript">

window.signals = [];
var signalColor = '#27AE60';

var canvas, context;
var zoomLevel = 10;

/*
* main map data
*/

var landShift = {
    left: 0,
    top: 0
};

var land = {
    width: 36,
    height: 26
};
var house = {
    width: 19,
    height: 10.5
};
var houseShift = {
    left: 5.5,
    top: 10.6
}

var zoom = function (dimention) {
    return zoomLevel * dimention;
}

var getHousePosion = function () {
    return {
        left: landShift.left + houseShift.left,
        top: landShift.top + houseShift.top
    };
};

/*
* objects to add on map
*/

var scanners = [
    { 
        id: 'living-room', 
        radius: 5,
        color: '#00008B',
        position: {
            left: ( getHousePosion().left + house.width - 1 ),
            top: ( getHousePosion().top )        
        }
    },
    { 
        id: 'garrage',
        radius: 5,
        color: '#00008B',
        position: {
            left: 3,
            top: ( getHousePosion().top )        
        }
    }
];

var findScanner = function (id) {
    var found;
    scanners.forEach(scanner => {
        if(scanner.id === id) {
            found = scanner;
        }
    });
    return found;
};

var drawObjects = function (contex, objects) {
    objects.forEach(o => {
        context.strokeStyle = o.color;
        context.beginPath();
        context.arc(
            zoom( landShift.left + o.position.left ), 
            zoom( landShift.top + o.position.top ), 
            o.radius, 
            0, 
            2 * Math.PI
        );
        context.stroke();
    });   
};

var drawSignals = function(context, signals) {
    if (signals && signals.length) {
        
        var signalsToDraw = [];
        signals.forEach(signal => {
            var scanner = findScanner(signal.id);
            if (scanner) {
                signalsToDraw.push({
                    color: signalColor,
                    position: scanner.position,
                    radius: signal.radius
                });
            }
        });
        drawObjects(context, signalsToDraw);
    }
};

/*
* render 
*/
var render = function () {
    canvas = document.getElementById('imageView');

    context = canvas.getContext('2d');
    context.clearRect(0, 0, canvas.width, canvas.height);
    context.lineWidth = 1;

    /* render land */
    context.strokeStyle = '#000000';
    context.strokeRect(
        zoom(landShift.left), 
        zoom(landShift.top), 
        zoom(land.width), 
        zoom(land.height)
    );

    /* render house */
    context.strokeStyle = '#000000';
    context.strokeRect(
        zoom(getHousePosion().left), 
        zoom(getHousePosion().top), 
        zoom(house.width), 
        zoom(house.height)
    );

    /* simulate line with parking on left */
    context.strokeStyle = '#000000';
    context.beginPath();
    context.moveTo(
        zoom(landShift.left), 
        zoom(getHousePosion().top)
    );
    context.lineTo(
        zoom(getHousePosion().left), 
        zoom(getHousePosion().top)
    );
    context.stroke();
    context.closePath();

    /* simulate line with parking on right*/
    context.strokeStyle = '#000000';
    context.beginPath();
    context.moveTo(
        zoom(getHousePosion().left + house.width), 
        zoom(getHousePosion().top + house.height)
    );
    context.lineTo(
        zoom(landShift.left + land.width),
        zoom(getHousePosion().top + house.height)
    );
    context.stroke();
    context.closePath();

    drawObjects(context, scanners);

    drawFlowerBeds();


    drawSignals(context, window.signals);
    console.log('r');
}

var flowerBeds2 = [
    {
      topShift: 2,
      leftShift: 8.6,
      sizeY: 4.2, 
      sizeX: 7.6
    }
  ];

window.flowerBeds = [
    {
      topShift: 4,
      leftShift: 11,
      sizeY: 4.2 / 2, 
      sizeX: 7.6 / 2
    }
  ];

var drawFlowerBeds = function() {

    window.flowerBeds.forEach(flowerBed => {

        context.strokeStyle = 'red';
        context.beginPath();
        context.moveTo(
            zoom(landShift.left), 
            zoom(flowerBeds2[0].topShift)
        );
        context.lineTo(
            zoom(flowerBeds2[0].sizeX), 
            zoom(flowerBeds2[0].topShift)
        );
        context.stroke();
        context.closePath();



      context.strokeStyle = 'green';
      context.beginPath();

      context.ellipse(
        zoom( landShift.left + flowerBed.leftShift ), 
        zoom( landShift.top + flowerBed.topShift),  
        zoom( flowerBed.sizeX ), 
        zoom( flowerBed.sizeY) , 
        0, 
        0, 
        2 * Math.PI
      );
      context.stroke();
    })
  }

render();
window.setInterval(render, 5000);

// this to be updated by client
window.signals = [
    {
        id: 'garrage',
        radius: 15    
    },
    {
        id: 'living-room',
        radius: 25
    }
];

/*
ctx.fillStyle = "red";
ctx.fillRect(20, 20, 150, 10);
*/

</script>
</body>
</html>